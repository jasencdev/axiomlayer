# Authentik Helm Values
# Install with: helm install authentik authentik/authentik -n authentik -f values.yaml

authentik:
  secret_key: "" # Set via --set or secret
  postgresql:
    password: "" # Set via --set or secret

postgresql:
  enabled: true
  auth:
    password: "" # Set via --set or secret

redis:
  enabled: true

server:
  ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
      - auth.lab.axiomlayer.com
    tls:
      - secretName: authentik-tls
        hosts:
          - auth.lab.axiomlayer.com

# Enable service connection for outpost deployment
serviceAccount:
  create: true
  serviceAccountName: authentik

# RBAC for outpost management
rbac:
  create: true
  createClusterRole: true
  createClusterRoleBinding: true
  clusterRoleRules:
    # Permissions needed for outpost deployment
    - apiGroups: [""]
      resources: ["namespaces", "pods", "services", "secrets", "configmaps", "serviceaccounts"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["apps"]
      resources: ["deployments", "statefulsets", "daemonsets", "replicasets"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["networking.k8s.io"]
      resources: ["ingresses"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["rbac.authorization.k8s.io"]
      resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["apiextensions.k8s.io"]
      resources: ["customresourcedefinitions"]
      verbs: ["list"]
    # Allow watching traefik middlewares for forward auth
    - apiGroups: ["traefik.io", "traefik.containo.us"]
      resources: ["middlewares"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
